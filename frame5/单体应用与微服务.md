# 单体应用与微服务

## 单体应用

#### 从单体架构说起

- 一个归档包（例如war包）包含所有功能的应用程序，我们通常称为单体应用。而架构单体应用的方法论，就是单体应用架构

  ![img](https://images.shiguangping.com/imgs/20200817232743)



#### 单体架构的优点：

- 架构简单
- 开发、测试、部署方便



#### 单体架构的缺点：

- 复杂性高
- 部署慢、频率低
- 扩展能力受限
- 阻碍技术创新



单体架构适合开发小型的，功能不那么复杂的应用。

---

## 微服务

#### 微服务“定义”

一词最早来自于Martin Fowler的一篇[微服务文章](https://martinfowler.com/articles/microservices.html)

![img](https://images.shiguangping.com/imgs/20200817232650)

> 微服务架构风格是一种将一个单一应用程序开发为一组小型服务的方法，每个服务运行在自己的进程中，服务间通信采用轻量级通信机制（通常用HTTP资源API）。这些服务围绕业务能力构建并且可通过全自动部署机制独立部署。这些服务共用一个最小型的集中式的管理，服务可用不同的语言开发，使用不同的数据存储技术。



#### 微服务特性（1）

- 每个微服务可独立运行在自己的进程里；（也就是说每个微服务都运行在自己的Tomcat中）
- 一系列独立运行的微服务共同构建起整个系统；
- 每个服务为独立的业务开发，一个微服务只关注某个特定的功能，例如订单管理、用户管理等；



#### 微服务特性（2）

- 可使用不同的语言与存储技术（契合项目情况和团队实力）；
- 微服务之间通过清凉的通信机制进行通信，例如通过REST API进行调用；
- 全自动部署机制。



#### 微服务全景架构图

![img](https://images.shiguangping.com/imgs/20200817232716)



#### 微服务的优点：

- 单个服务更易于开发、维护
- 单个微服务启动较快
- 局部修改，容易部署
- 技术栈不受限（如果某个微服务需要更换技术栈，重构成本是有限的）
- 按需伸缩（如果某个服务是CPU密集的，只需将该微服务迁移到CPU性能更好的服务器即可）



#### 微服务的缺点：

- 运维要求高
- 分布式固有的复杂性
- 重复劳动



#### 微服务的使用场景：

- 大型、复杂的项目
- 有快速迭代的需求
- 访问压力大



#### 不适用微服务的场景：

- 业务稳定
- 迭代周期长



#### 微服务拆分-方法论：

- 领域驱动设计(Domain Driven Design)，简称：DDD
- 面向对象(by name. / by verb.)



#### 微服务拆分-最佳实践：

- 职责划分
- 通用性划分



#### 微服务拆分-合理的粒度：

- 良好地满足业务
- 幸福感
- 增量迭代
- 持续进化

微服务的拆分粒度是一个动态的、持续且变化的，随着项目的更新迭代，微服务的拆分粒度应该合理地改变。